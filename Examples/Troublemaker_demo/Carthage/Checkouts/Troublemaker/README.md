# Troublemaker
Troublemaker lets you inject warnings and errors in Xcode IDE. This framework uses unofficial and undocumented APIs and might stop working with the new releases of Xcode.

[![Build Status](https://travis-ci.org/thelvis4/Troublemaker.svg?branch=master)](https://travis-ci.org/thelvis4/Troublemaker)

[ [Motivation](#motivation) &bull; [How it works](#how-it-works) &bull; [Integration](#integration)
&bull; [Usage](#usage) &bull; [Contributing](#contributing) &bull; [Known Issues](#known-issues) &bull; [License](#license) ]


## Motivation
Have you ever integrated a tool(code style checker or other code analyzer) and you needed to display warnings in Xcode? 
Then most probably, you did that by adding a `New Run Script Phase` in `Build Phases`.
That works pretty well if you want to get warnings related to build process (Ex. to [see your `//TODO:` and `//FIXME:` comments as warnings](https://deallocatedobjects.com/posts/show-todos-and-fixmes-as-warnings-in-xcode-4)).
Although, this approach comes with some implications that could be very inconvenient sometimes:
* You have to build the product every time you want to run the script.
* The script gets run every time you want to make a build.
* The script goes together with the project, but the tool triggered by the script might not(let's say the script calles a CLI installed in `/usr/bin/`). If additional checks aren't made, some issues may appear.

There is no other official way to show custom warnings in Xcode. So, we had to hack it. ðŸ‘»

## How it works
Troublemaker is a wrapper on [XcodeIDEKit](https://github.com/thelvis4/XcodeIDEKit). XcodeIDEKit starts by getting access to Xcode's `NSWindowController`. From there, using the ObjC runtime and a couple of hacky tricks, it gets access to `IDEIssueManager` which is part of `IDEFoundation.framework`.
Getting Xcode's window controller is essential here. The way it can be done now is by using a Xcode plugin and calling Troublemaker from plugin's source code. To create a Xcode plugin you can use this Project Template(https://github.com/kattrali/Xcode-Plugin-Template).

For more info about Xcode plugins, read [this great article by NSHipster](http://nshipster.com/xcode-plugins/).

## Integration

#### Clone the project
```shell
git clone git@github.com:thelvis4/Troublemaker.git
```
Pull the submodules:
```shell
cd Troublemaker
git submodule update --init
```

#### Build and import the framework
- Build Troublemaker.
- In Xcode, Go to `Products` group.
- Right-click on `Troublemaker.framework` => `Show in Finder`
- Drag and drop `Troublemaker.framework` and `XcodeIDEKit.framework` in your project.

#### As Xcode subproject
- Drag and drop `Troublemaker.xcodeproj` file into your project.
- In `Build Phases` => `Target Dependencies` add Troublemaker framework as dependency.
- Add `Troublemaker` to `Link Binary With Libraries`

## Usage

#### Initialization
```swift
guard let troublemaker = Troublemaker() else {
    print("Could not initialize Troublemaker.")
    return
}
```

#### Add issues
##### Using a log string
```swift
if let logIssue = Issue(log: "warning: Hello Troublemakers!") {
    troublemaker.addIssue(logIssue)
}
```
##### Using IssueData
Warning:
```swift
let issueData = IssueData(title: "Hey hey!", filePath: "/path/to/file.swift", line: 5)
let warning = Issue.Warning(issueData)
troublemaker.addIssue(warning)
```
Error:
```swift
let issueData = IssueData(title: "Hey hey!", filePath: "/path/to/file.swift", line: 5)
let error = Issue.Error(issueData)
troublemaker.addIssue(error)
```

#### Remove issues
To remove all the issues (including Xcode generated):
```swift
troublemaker.clearAllIssues()
```
To remove the issues generated by Troublemaker:
```swift
troublemaker.clearGeneratedIssues()
```

## Contributing
This project is WIP. If you've spotted a bug or an issue, please open a [New Issue](https://github.com/thelvis4/Troublemaker/issues/new). If you want to contribute to the codebase, please submit a [Pull request](https://help.github.com/articles/using-pull-requests/).

## Known Issues
* Issues don't disappear when you `Product` => `Clean` (â‡§âŒ˜K).

## License
This project is [MIT licensed](https://github.com/thelvis4/Troublemaker/blob/master/LICENSE).
